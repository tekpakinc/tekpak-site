
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>YardOS — eBay Tools</title>
  <link rel="stylesheet" href="./styles.css"/>
</head>
<body>
  <header class="topbar">
    <div class="wrap">
      <div class="brand">
        <img id="logo" alt="Tek-Pak" />
        <span class="badge">eBay Tools</span>
      </div>
      <nav class="nav">
        <a href="./index.html">Dashboard</a>
        <a href="./inventory.html">Inventory</a>
        <a class="active" href="./ebay.html">eBay Tools</a>
        <a href="./store.html">Store</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="grid cols-2">
      <div class="card">
        <div class="hd">
          <div>
            <h2>Generate eBay HTML</h2>
            <div class="sub">Writes into the eBay_HTML cell for that row</div>
          </div>
        </div>
        <div class="bd">
          <div class="controls">
            <select class="select" id="tabSel">
              <option value="Inventory_Retail">Inventory_Retail</option>
              <option value="Inventory_Parts">Inventory_Parts</option>
            </select>
            <input class="input" id="rowNum" placeholder="Row number (>=2)" />
            <button class="btn primary" id="btnGen">Generate</button>
          </div>

          <hr class="sep">
          <div class="small">
            Tip: row number is the actual sheet row. If your item is on row 25, put 25.
          </div>

          <div style="height:12px"></div>
          <div class="small" id="genMeta">No generation yet.</div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <h2>Preview & Copy</h2>
            <div class="sub">Pulls the row and shows the HTML</div>
          </div>
        </div>
        <div class="bd">
          <div class="controls">
            <button class="btn" id="btnLoadRow">Load Row</button>
            <button class="btn good" id="btnCopy">Copy HTML</button>
          </div>

          <div style="height:12px"></div>
          <textarea id="htmlBox" class="input" style="width:100%; min-height:340px; font-family:var(--mono);" placeholder="Generated HTML will appear here…"></textarea>
          <div style="height:12px"></div>
          <div class="small">eBay note: keep phone/email/website out of listings. This template already avoids it.</div>
        </div>
      </div>
    </div>
  </main>

<script src="./app.js"></script>
<script>
qs("#logo").src = "https://raw.githubusercontent.com/tekpakinc/tekpak-site/b8d52da6ac61c4f06d12cd8b9253cb6103b8dad9/tekpak-logo.png";

async function loadRow(){
  const tab = qs("#tabSel").value;
  const row = Number(qs("#rowNum").value || 0);
  if (!row || row < 2) return toast("Enter a valid row number (>=2).", "bad");

  // We don’t have a single-row endpoint yet, so we’ll load all then filter by _row.
  const data = await apiGet({ action:"listInventory", tab });
  const item = data.items.find(x => x._row === row);
  if (!item) throw new Error(`Row ${row} not found in ${tab}.`);
  qs("#htmlBox").value = String(item.eBay_HTML || "").trim();
  if (!qs("#htmlBox").value) toast("eBay_HTML is empty for that row. Generate it first.", "bad");
  else toast("Loaded eBay_HTML from sheet.");
}

qs("#btnGen").addEventListener("click", async ()=>{
  const tab = qs("#tabSel").value;
  const row = Number(qs("#rowNum").value || 0);
  if (!row || row < 2) return toast("Enter a valid row number (>=2).", "bad");
  try{
    const res = await apiGet({ action:"generateEbayHtml", tab, row, user:"yardos-web" });
    qs("#genMeta").textContent = `Generated for SKU ${res.TP_SKU || "N/A"} • ${res.bytes} bytes written`;
    toast("Generated eBay HTML.");
    await loadRow();
  }catch(err){
    toast(err.message, "bad");
  }
});

qs("#btnLoadRow").addEventListener("click", async ()=>{
  try{ await loadRow(); } catch(err){ toast(err.message,"bad"); }
});

qs("#btnCopy").addEventListener("click", async ()=>{
  const txt = qs("#htmlBox").value.trim();
  if (!txt) return toast("Nothing to copy.", "bad");
  await navigator.clipboard.writeText(txt);
  toast("Copied HTML to clipboard.");
});
</script>
</body>
</html>
