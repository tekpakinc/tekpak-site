<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tek-Pak Surplus Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f4f6f8;
  --panel:#ffffff;
  --steel:#e2e6ea;
  --border:#cfd6dd;
  --text:#1e2933;
  --muted:#5f6b7a;
  --accent:#2b6cb0;
  --buy:#2f855a;
  --bid:#d69e2e;
  --radius:10px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */
header{
  background:#ffffff;
  border-bottom:2px solid var(--steel);
}
.wrap{
  max-width:1300px;
  margin:auto;
  padding:16px;
}
.top{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
  justify-content:space-between;
}
h1{
  margin:0;
  font-size:20px;
}
.sub{
  font-size:12px;
  color:var(--muted);
}

/* CONTROLS */
.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
input,select{
  padding:10px 12px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#fff;
  font-size:14px;
}

/* GRID */
main{padding-top:18px}
.grid{
  display:grid;
  gap:14px;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  display:flex;
  flex-direction:column;
}
.img{
  height:150px;
  border-bottom:1px solid var(--steel);
  background:#fafafa;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:zoom-in;
}
.img img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.ph{
  font-size:12px;
  color:var(--muted);
}

/* CONTENT */
.content{
  padding:12px;
  display:flex;
  flex-direction:column;
  height:100%;
}
.title{
  font-size:14px;
  font-weight:600;
  margin-bottom:6px;
}
.meta{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  font-size:11px;
  margin-bottom:8px;
}
.tag{
  border:1px solid var(--border);
  padding:4px 7px;
  border-radius:4px;
  background:#f8fafc;
}
.price{
  margin-left:auto;
  font-weight:700;
}
.desc{
  font-size:12px;
  color:var(--muted);
  margin-bottom:10px;
}
.actions{
  margin-top:auto;
  display:flex;
  gap:8px;
}
.btn{
  flex:1;
  padding:9px;
  border-radius:6px;
  text-align:center;
  text-decoration:none;
  font-size:13px;
  font-weight:600;
  color:#fff;
}
.buy{background:var(--buy)}
.bid{background:var(--bid); color:#000}
.disabled{
  opacity:.4;
  pointer-events:none;
}

/* FOOTER */
footer{
  margin-top:28px;
  padding-top:14px;
  border-top:2px solid var(--steel);
  font-size:12px;
  color:var(--muted);
}

/* LIGHTBOX */
#lightbox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
#lightbox img{
  max-width:90%;
  max-height:90%;
  background:#fff;
  padding:8px;
  border-radius:6px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}
</style>
</head>

<body>

<header>
  <div class="wrap top">
    <div>
      <h1>Tek-Pak Surplus Inventory</h1>
      <div class="sub">Live public inventory â€¢ Buy Now or Bid</div>
    </div>
    <div class="controls">
      <input id="search" placeholder="Search part, SKU, modelâ€¦">
      <select id="category">
        <option value="">All categories</option>
      </select>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid" id="grid"></div>

  <footer>
    Inventory updates automatically.  
    Internal asset items are not displayed.
  </footer>
</main>

<!-- IMAGE LIGHTBOX -->
<div id="lightbox">
  <img id="lightbox-img">
</div>

<script>
/* ================= CONFIG ================= */
const DATA_URL =
"https://script.google.com/macros/s/AKfycbyLMf07vAWn1qdtL_FMVvCRf6GytYvXAtbzTLgqZRHurZisb7Qba4gYtsTwkhL-8vJu/exec";

/* ================= STATE ================= */
let INVENTORY = [];

const els = {
  grid: document.getElementById("grid"),
  search: document.getElementById("search"),
  category: document.getElementById("category")
};

/* ================= HELPERS ================= */
const txt = v => (v ?? "").toString().toLowerCase();
const money = v => {
  const n = Number(v);
  return isFinite(n)
    ? n.toLocaleString("en-US",{style:"currency",currency:"USD"})
    : "â€”";
};

/* ================= FETCH ================= */
async function loadInventory(){
  const res = await fetch(DATA_URL);
  const json = await res.json();
  INVENTORY = Array.isArray(json) ? json : (json.data || []);
  populateCategories();
  applyFilters();
}

/* ================= UI ================= */
function populateCategories(){
  const cats=[...new Set(
    INVENTORY
      .filter(i => !txt(i.description).includes("asset"))
      .map(i=>i.category)
      .filter(Boolean)
  )].sort();

  els.category.innerHTML=`<option value="">All categories</option>`;
  cats.forEach(c=>{
    const o=document.createElement("option");
    o.value=c;
    o.textContent=c;
    els.category.appendChild(o);
  });
}

function render(list){
  els.grid.innerHTML="";
  list.forEach(i=>{
    els.grid.innerHTML+=`
      <div class="card">
        <div class="img">
          ${i.image
            ? `<img src="${i.image}" onclick="openLightbox('${i.image.replace(/'/g,"\\'")}')">`
            : `<div class="ph">No Image</div>`
          }
        </div>
        <div class="content">
          <div class="title">${i.title || "Unnamed Item"}</div>
          <div class="meta">
            <span class="tag">${i.category || "â€”"}</span>
            <span class="tag">${i.sku || "No SKU"}</span>
            <span class="tag"><strong>Condition:</strong> ${i.condition || "Not specified"}</span>
            <span class="price">${money(i.price)}</span>
          </div>
          <div class="desc">${i.description || ""}</div>
          <div class="actions">
            <a class="btn buy ${i.buy_url?"":"disabled"}"
               href="${i.buy_url||"#"}" target="_blank">Buy Now</a>
            <a class="btn bid ${i.bid_url?"":"disabled"}"
               href="${i.bid_url||"#"}" target="_blank">Bid</a>
          </div>
        </div>
      </div>
    `;
  });
}

/* ================= FILTERS ================= */
function applyFilters(){
  const q = txt(els.search.value);
  const c = els.category.value;

  render(
    INVENTORY
      // ðŸš« HIDE INTERNAL ASSETS
      .filter(i => !txt(i.description).includes("asset"))
      // ðŸ” PUBLIC FILTERS
      .filter(i => {
        return (
          (!q ||
            txt(i.title).includes(q) ||
            txt(i.sku).includes(q) ||
            txt(i.description).includes(q)
          ) &&
          (!c || i.category === c)
        );
      })
  );
}

/* ================= EVENTS ================= */
els.search.addEventListener("input",applyFilters);
els.category.addEventListener("change",applyFilters);

/* ================= LIGHTBOX ================= */
function openLightbox(src){
  document.getElementById("lightbox-img").src = src;
  document.getElementById("lightbox").style.display="flex";
}
document.getElementById("lightbox").addEventListener("click",()=>{
  document.getElementById("lightbox").style.display="none";
});
document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    document.getElementById("lightbox").style.display="none";
  }
});

/* ================= INIT ================= */
loadInventory();
</script>

</body>
</html>

