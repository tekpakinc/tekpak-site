<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tek-Pak Inventory Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* ================================
       LIGHT MODE + BRUSHED METAL THEME
       ================================ */

    :root {
      --bg: #e6e7ea; 
      --bg-panel: #f4f5f7;
      --bg-panel-alt: #ffffff;
      --metal: #c8cdd2;
      --accent: #4a6ea8; 
      --accent-soft: #7fa0d6;
      --text: #111317;
      --muted: #4d535a;
      --border: #b9bcc0;
      --danger: #d9534f;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.8), rgba(215,218,225,0.85)),
        url("https://www.transparenttextures.com/patterns/brushed-alum.png");
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px;
      gap: 12px;
    }

    /* ---------- NAV BAR ---------- */
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 18px;
      border-radius: 14px;
      background: linear-gradient(120deg,#ffffffdd,#eceef0dd);
      border: 1px solid var(--border);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      backdrop-filter: blur(8px);
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .tp-logo {
      height: 48px;
      width: auto;
      object-fit: contain;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25));
    }

    .nav-title {
      display: flex;
      flex-direction: column;
    }

    .nav-title-main {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.06em;
      color: var(--accent);
    }

    .nav-title-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #3bb44b;
      box-shadow: 0 0 6px rgba(59,180,75,0.5);
      margin-right: 5px;
    }

    /* ---------- LAYOUT ---------- */
    .layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      min-height: 0;
    }

    @media(max-width: 960px){
      .layout{ grid-template-columns: 1fr; }
    }

    /* ---------- PANELS ---------- */
    .panel {
      background: linear-gradient(135deg,#ffffffee,#f0f1f3cc);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .panel-title {
      font-size:14px;
      text-transform:uppercase;
      font-weight:700;
      color:var(--accent);
      margin-bottom:3px;
      letter-spacing:0.1em;
    }

    .panel-sub {
      font-size:12px;
      color:var(--muted);
      margin-bottom:10px;
    }

    /* ---------- FILTERS ---------- */
    .filters {
      display:grid;
      grid-template-columns:1.4fr 1fr 1fr 1fr;
      gap:8px;
      margin-bottom:10px;
    }

    @media(max-width:900px){
      .filters{ grid-template-columns:1fr 1fr; }
    }

    .field-label {
      font-size:11px;
      color:var(--muted);
      margin-bottom:3px;
    }

    input,select,textarea {
      width:100%;
      padding:7px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      background:#ffffffee;
      box-shadow: inset 0 0 3px rgba(0,0,0,0.1);
      font-size:12px;
    }

    input:focus,select:focus,textarea:focus {
      border-color:var(--accent);
      box-shadow:0 0 5px rgba(74,110,168,0.3);
      outline:none;
    }

    /* ---------- INVENTORY LIST ---------- */
    .inventory-list {
      flex:1;
      overflow-y:auto;
      padding-right:6px;
    }

    .card {
      display:grid;
      grid-template-columns:2fr 1.4fr auto;
      gap:8px;
      padding:10px 12px;
      margin-bottom:8px;
      background:#ffffffee;
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }

    @media(max-width:800px){
      .card{ grid-template-columns:1fr; }
    }

    .card-main-title {
      font-size:13px;
      font-weight:700;
      margin-bottom:2px;
    }

    .tag {
      font-size:10px;
      border-radius:999px;
      padding:3px 7px;
      border:1px solid var(--border);
      background:#f8f9fa;
      color:var(--muted);
      margin-right:4px;
    }

    .tag-status-listed { color:var(--accent); border-color:var(--accent); }
    .tag-status-sold { color:var(--danger); border-color:var(--danger); }
    .tag-status-hold { color:#e6a200; border-color:#e6a200; }

    /* ---------- BUTTONS ---------- */
    .btn {
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      border:1px solid var(--border);
      background:#ffffffdd;
      cursor:pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      color:white;
      border-color:#2e4a78;
    }

    .btn-danger {
      background: linear-gradient(135deg,#d9534f,#b9403d);
      color:white;
      border-color:#9e2f2c;
    }

    .btn:hover {
      filter:brightness(1.05);
    }

    /* ---------- FORM GRID ---------- */
    .form-grid {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }

    @media(max-width:800px){
      .form-grid{ grid-template-columns:1fr; }
    }

    .section-divider{
      margin:10px 0;
      border-top:1px solid var(--border);
    }

  </style>
</head>

<body>
  <div class="shell">

    <!-- ========================================================= -->
    <!--              BRANDED HEADER WITH LOGO                     -->
    <!-- ========================================================= -->
    <header class="nav">
      <div class="nav-left">
        <img src="tekpak-logo.png" class="tp-logo" alt="Tek-Pak Logo">

        <div class="nav-title">
          <div class="nav-title-main">Tek-Pak Inventory</div>
          <div class="nav-title-sub">Employee Portal · Light Metal Edition</div>
        </div>
      </div>

      <div class="nav-right" style="display:flex;align-items:center;gap:6px;">
        <div class="status-dot"></div>
        <span id="apiStatus">Connecting…</span>
      </div>
    </header>

    <!-- ========================================================= -->
    <!--                       MAIN LAYOUT                         -->
    <!-- ========================================================= -->
    <main class="layout">

      <!-- ========================================================= -->
      <!--                      INVENTORY PANEL                      -->
      <!-- ========================================================= -->
      <section class="panel">
        <div class="panel-title">Inventory</div>
        <div class="panel-sub">Browse, search, and edit items.</div>

        <button class="btn btn-primary" onclick="reloadData()">Refresh</button>

        <div class="filters" style="margin-top:10px;">
          <div>
            <div class="field-label">Search</div>
            <input type="text" id="searchInput" placeholder="Title, Model, Serial…" oninput="onFilterChange()">
          </div>

          <div>
            <div class="field-label">Category</div>
            <select id="filterCategory" onchange="onFilterChange()">
              <option value="">All</option>
            </select>
          </div>

          <div>
            <div class="field-label">Status</div>
            <select id="filterStatus" onchange="onFilterChange()">
              <option value="">All</option>
              <option>Hold</option>
              <option>Listed</option>
              <option>Sold</option>
            </select>
          </div>

          <div>
            <div class="field-label">Location</div>
            <select id="filterLocation" onchange="onFilterChange()">
              <option value="">All</option>
            </select>
          </div>
        </div>

        <div id="inventoryList" class="inventory-list"></div>
      </section>

      <!-- ========================================================= -->
      <!--                      ITEM EDITOR PANEL                    -->
      <!-- ========================================================= -->
      <section class="panel">
        <div class="panel-title">Item Editor</div>
        <div class="panel-sub">Add new items or update existing entries.</div">

        <form id="itemForm" onsubmit="onSubmitItem(event)">
          <div class="form-grid">

            <div>
              <div class="field-label">TP-SKU (auto if blank)</div>
              <input type="text" id="fTP_SKU">
            </div>

            <div>
              <div class="field-label">Title</div>
              <input type="text" id="fTitle" required>
            </div>

            <div>
              <div class="field-label">Manufacturer</div>
              <select id="fManufacturer"></select>
            </div>

            <div>
              <div class="field-label">Model</div>
              <input type="text" id="fModel">
            </div>

            <div>
              <div class="field-label">Serial</div>
              <input type="text" id="fSerial">
            </div>

            <div>
              <div class="field-label">Color</div>
              <select id="fColor">
                <option value="">—</option>
                <option>Black</option>
                <option>White</option>
                <option>Silver</option>
                <option>Grey</option>
                <option>Blue</option>
                <option>Red</option>
                <option>Green</option>
                <option>Yellow</option>
                <option>Gold</option>
                <option>Purple</option>
                <option>Orange</option>
                <option>Pink</option>
                <option>Brown</option>
              </select>
            </div>

            <div>
              <div class="field-label">Category</div>
              <select id="fCategory"></select>
            </div>

            <div>
              <div class="field-label">Status</div>
              <select id="fStatus">
                <option value="">—</option>
                <option>Hold</option>
                <option>Listed</option>
                <option>Sold</option>
              </select>
            </div>

            <div>
              <div class="field-label">Location</div>
              <select id="fLocation"></select>
            </div>

            <div>
              <div class="field-label">Condition</div>
              <input type="text" id="fCondition">
            </div>

            <div>
              <div class="field-label">eBay Item ID</div>
              <input type="text" id="fEbayID">
            </div>

            <div>
              <div class="field-label">eBay URL</div>
              <input type="text" id="fEbayURL">
            </div>

            <div><div class="field-label">Image 1</div><input type="text" id="fImage1"></div>
            <div><div class="field-label">Image 2</div><input type="text" id="fImage2"></div>
            <div><div class="field-label">Image 3</div><input type="text" id="fImage3"></div>
            <div><div class="field-label">Image 4</div><input type="text" id="fImage4"></div>

            <div>
              <div class="field-label">Dimensions</div>
              <input type="text" id="fDimensions">
            </div>

            <div>
              <div class="field-label">Weight</div>
              <input type="text" id="fWeight">
            </div>

            <div>
              <div class="field-label">Acquired Price</div>
              <input type="number" step="0.01" id="fAcquiredPrice">
            </div>

            <div>
              <div class="field-label">Sold</div>
              <input type="text" id="fSold">
            </div>

          </div><!-- form grid end -->

          <div class="section-divider"></div>

          <div>
            <div class="field-label">Notes</div>
            <textarea id="fNotes"></textarea>
          </div>

          <div style="display:flex;justify-content:space-between;margin-top:10px;">
            <button type="button" class="btn" onclick="resetForm()">Clear</button>
            <button type="submit" class="btn btn-primary">Save Item</button>
          </div>

        </form>

        <div class="section-divider"></div>

        <!-- LIST MANAGER -->
        <div>
          <div class="panel-title">List Manager</div>
          <div class="panel-sub">Update dropdown lists (categories, manufacturers, etc).</div>

          <div class="form-grid">
            <div>
              <div class="field-label">Categories</div>
              <textarea id="listCategories"></textarea>
            </div>

            <div>
              <div class="field-label">Manufacturers</div>
              <textarea id="listManufacturers"></textarea>
            </div>

            <div>
              <div class="field-label">Locations</div>
              <textarea id="listLocations"></textarea>
            </div>

            <div>
              <div class="field-label">Status</div>
              <textarea id="listStatus"></textarea>
            </div>
          </div>

          <div style="display:flex;justify-content:space-between;margin-top:10px;">
            <button class="btn btn-danger" onclick="resetListsUi()">Reset</button>
            <button class="btn btn-primary" onclick="saveLists()">Save Lists</button>
          </div>

        </div>

        <div style="margin-top:10px;font-size:12px;color:var(--muted);">
          <span id="statusText">Ready.</span>
        </div>

      </section>
    </main>
  </div>

  <!-- ========================================================= -->
  <!--                      JAVASCRIPT LOGIC                      -->
  <!-- ========================================================= -->
  <script>
    /* ===============================
       SET YOUR API URL HERE
    =============================== */
    const API_BASE = "https://script.google.com/macros/s/YOUR_DEPLOYMENT/exec";


    let inventory=[];
    let lists={categories:[],locations:[],status:[],manufacturers:[]};
    let currentFilters={search:"",category:"",status:"",location:""};
    let currentEditRowIndex=null;

    function setApiStatus(m){document.getElementById("apiStatus").textContent=m;}
    function setStatus(m){document.getElementById("statusText").textContent=m;}

    async function apiGet(action){
      const r=await fetch(`${API_BASE}?action=${action}`);
      return r.json();
    }

    async function apiPost(action,data){
      const r=await fetch(`${API_BASE}?action=${action}`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(data||{})
      });
      return r.json();
    }

    /* ===============================
       LOAD DATA
    =============================== */
    async function reloadData(){
      setApiStatus("Loading…");
      setStatus("Refreshing inventory…");

      const [inv, lst] = await Promise.all([
        apiGet("getInventory"),
        apiGet("getLists")
      ]);

      inventory = inv.ok ? inv.data : [];
      lists = lst.ok ? lst.data : lists;

      fillFormDropdowns();
      fillFilterDropdowns();
      fillListsTextareas();
      renderInventory();

      setApiStatus("Online");
      setStatus(`Loaded ${inventory.length} items.`);
    }

    /* ===============================
       FILL DROPDOWNS
    =============================== */
    function fillFormDropdowns(){
      const fill=(id,arr)=>{
        const s=document.getElementById(id);
        s.innerHTML=`<option value=""></option>`;
        arr.forEach(v=>s.innerHTML+=`<option>${v}</option>`);
      };

      fill("fManufacturer", lists.manufacturers);
      fill("fCategory", lists.categories);
      fill("fLocation", lists.locations);
    }

    function fillFilterDropdowns(){
      const fill=(id,arr)=>{
        const s=document.getElementById(id);
        const cur=s.value;
        s.innerHTML=`<option value="">All</option>`;
        arr.forEach(v=>s.innerHTML+=`<option>${v}</option>`);
        if(cur) s.value=cur;
      };

      fill("filterCategory", lists.categories);
      fill("filterLocation", lists.locations);
    }

    function fillListsTextareas(){
      document.getElementById("listCategories").value = lists.categories.join("\n");
      document.getElementById("listManufacturers").value = lists.manufacturers.join("\n");
      document.getElementById("listLocations").value = lists.locations.join("\n");
      document.getElementById("listStatus").value = lists.status.join("\n");
    }

    /* ===============================
       FILTER LOGIC
    =============================== */
    function onFilterChange(){
      currentFilters.search = document.getElementById("searchInput").value.toLowerCase();
      currentFilters.category = document.getElementById("filterCategory").value;
      currentFilters.status = document.getElementById("filterStatus").value;
      currentFilters.location = document.getElementById("filterLocation").value;
      renderInventory();
    }

    /* ===============================
       RENDER INVENTORY CARDS
    =============================== */
    function renderInventory(){
      const box=document.getElementById("inventoryList");
      box.innerHTML="";

      let result = inventory.slice();

      if(currentFilters.search){
        const q=currentFilters.search;
        result = result.filter(i=>(
          (i["Title"]||"")+
          (i["Model"]||"")+
          (i["Serial"]||"")+
          (i["TP-SKU"]||"")
        ).toLowerCase().includes(q));
      }

      if(currentFilters.category){
        result = result.filter(i=>i["Category"]===currentFilters.category);
      }

      if(currentFilters.status){
        result = result.filter(i=>i["Status"]===currentFilters.status);
      }

      if(currentFilters.location){
        result = result.filter(i=>i["Location"]===currentFilters.location);
      }

      if(result.length===0){
        box.innerHTML=`<div style="padding:10px;color:var(--muted);">No items match your filters.</div>`;
        return;
      }

      result.forEach(item=>{
        const c=document.createElement("div");
        c.className="card";

        c.innerHTML=`
          <div>
            <div class="card-main-title">${item["Title"]||"(No title)"}</div>
            <div>${item["Manufacturer"]||""} ${item["Model"]||""}</div>
            <div style="color:var(--muted);font-size:11px;">SKU: ${item["TP-SKU"]||"—"} · Serial: ${item["Serial"]||"—"}</div>
            <div style="margin-top:3px;">
              <span class="tag">${item["Category"]||"Uncategorized"}</span>
              <span class="tag">${item["Location"]||"No location"}</span>
              <span class="tag tag-status-${(item["Status"]||"").toLowerCase()}">${item["Status"]||"Status"}</span>
            </div>
          </div>

          <div>
            <div style="color:var(--muted);font-size:11px;">${item["Notes"]||"No notes"}</div>

            <div style="margin-top:4px;">
              ${item["eBay Web URL"] ? `<a href="${item["eBay Web URL"]}" target="_blank" style="color:var(--accent);">Open eBay</a>` : "No eBay link"}
            </div>

            <div style="color:var(--muted);margin-top:4px;font-size:11px;">
              Cost: ${item["Acquired Price"]?"$"+item["Acquired Price"]:"—"} · Sold: ${item["Sold"]||"No"}
            </div>
          </div>

          <div style="display:flex;flex-direction:column;gap:6px;">
            <button class="btn btn-primary" onclick="startEditItem(${item.rowIndex})">Edit</button>
            ${item["Image 1"]? `<button class="btn" onclick="window.open('${item["Image 1"]}','_blank')">Image</button>` : ""}
          </div>
        `;

        c.querySelector("button.btn-primary").onclick=()=>startEditItem(item);
        box.appendChild(c);
      });

    }

    /* ===============================
       EDIT ITEM
    =============================== */
    function startEditItem(item){
      currentEditRowIndex=item.rowIndex;
      setStatus("Editing item…");

      const fill=(id,v)=>document.getElementById(id).value=v||"";

      fill("fTP_SKU", item["TP-SKU"]);
      fill("fTitle", item["Title"]);
      fill("fManufacturer", item["Manufacturer"]);
      fill("fModel", item["Model"]);
      fill("fSerial", item["Serial"]);
      fill("fColor", item["Color"]);
      fill("fCategory", item["Category"]);
      fill("fStatus", item["Status"]);
      fill("fLocation", item["Location"]);
      fill("fCondition", item["Condition"]);
      fill("fEbayID", item["eBay Item ID"]);
      fill("fEbayURL", item["eBay Web URL"]);
      fill("fImage1", item["Image 1"]);
      fill("fImage2", item["Image 2"]);
      fill("fImage3", item["Image 3"]);
      fill("fImage4", item["Image 4"]);
      fill("fDimensions", item["Dimensions"]);
      fill("fWeight", item["Weight"]);
      fill("fAcquiredPrice", item["Acquired Price"]);
      fill("fSold", item["Sold"]);
      fill("fNotes", item["Notes"]);
    }

    function resetForm(){
      currentEditRowIndex=null;
      document.getElementById("itemForm").reset();
      setStatus("Cleared.");
    }

    /* ===============================
       SAVE ITEM
    =============================== */
    async function onSubmitItem(e){
      e.preventDefault();

      const f=(id)=>document.getElementById(id).value.trim();

      const fields={
        "TP-SKU": f("fTP_SKU"),
        "Title": f("fTitle"),
        "Manufacturer": f("fManufacturer"),
        "Model": f("fModel"),
        "Serial": f("fSerial"),
        "Color": f("fColor"),
        "Category": f("fCategory"),
        "Status": f("fStatus"),
        "Location": f("fLocation"),
        "Condition": f("fCondition"),
        "eBay Item ID": f("fEbayID"),
        "eBay Web URL": f("fEbayURL"),
        "Image 1": f("fImage1"),
        "Image 2": f("fImage2"),
        "Image 3": f("fImage3"),
        "Image 4": f("fImage4"),
        "Dimensions": f("fDimensions"),
        "Weight": f("fWeight"),
        "Acquired Price": f("fAcquiredPrice"),
        "Sold": f("fSold"),
        "Notes": f("fNotes")
      };

      /* Auto-generate TP-SKU if blank */
      if(!fields["TP-SKU"]){
        const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let r="";
        for(let i=0;i<9;i++) r+=chars[Math.floor(Math.random()*chars.length)];
        fields["TP-SKU"]="TP-"+r;
      }

      try{
        if(currentEditRowIndex){
          const r=await apiPost("updateItem",{rowIndex:currentEditRowIndex,fields});
          if(!r.ok) throw new Error(r.error);
        } else {
          const r=await apiPost("addItem", fields);
          if(!r.ok) throw new Error(r.error);
        }
        resetForm();
        reloadData();
      } catch(err){
        setStatus("Error: "+err.message);
      }
    }

    /* ===============================
       SAVE LISTS
    =============================== */
    async function saveLists(){
      const listsPayload={
        categories: document.getElementById("listCategories").value.split("\n").filter(Boolean),
        manufacturers: document.getElementById("listManufacturers").value.split("\n").filter(Boolean),
        locations: document.getElementById("listLocations").value.split("\n").filter(Boolean),
        status: document.getElementById("listStatus").value.split("\n").filter(Boolean),
      };

      try{
        setStatus("Saving lists…");
        const r=await apiPost("saveLists",{lists:listsPayload});
        if(!r.ok) throw new Error(r.error);
        reloadData();
      }catch(err){
        setStatus("Error: "+err.message);
      }
    }

    window.addEventListener("load", reloadData);
  </script>

</body>
</html>

